<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–ë–ª–æ–∫–Ω–æ—Ç –ú–∞—à–∏–Ω–∏—Å—Ç–∞ ¬∑ 2025 PRO</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#d32f2f">
<link rel="apple-touch-icon" href="assets/icons/icon-192.png">
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="appbar">
  <button id="menuBtn" class="iconbtn" aria-label="menu">‚ò∞</button>
  <div class="appbar-title">
    <div class="muted">–ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
    <div id="todayNorm" class="title">‚Äî</div>
  </div>
  <button id="goBtn" class="btn primary compact" title="–ü–æ–µ—Ö–∞–ª–∏!">‚ñ∂Ô∏é –ü–æ–µ—Ö–∞–ª–∏</button>
</header>

<nav id="drawer" class="drawer" aria-hidden="true">
  <div class="drawer-head">
    <div class="avatar">üöÇ</div>
    <div>
      <div class="drawer-title">–ë–ª–æ–∫–Ω–æ—Ç –ú–∞—à–∏–Ω–∏—Å—Ç–∞</div>
      <div class="muted small">PWA ‚Ä¢ –æ—Ñ—Ñ–ª–∞–π–Ω</div>
    </div>
  </div>
  <button class="navitem active" data-view="dashboard">–ü–æ–µ–∑–¥–∫–∏</button>
  <button class="navitem" data-view="sections">–£—á–∞—Å—Ç–∫–∏</button>
  <button class="navitem" data-view="tariffs">–¢–∞—Ä–∏—Ñ—ã –∏ –Ω–∞–¥–±–∞–≤–∫–∏</button>
  <button class="navitem" data-view="calc">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã</button>
  <button class="navitem" data-view="db">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
  <button class="navitem" data-view="refs">–°–ø—Ä–∞–≤–∫–∞</button>
  <button class="navitem" data-view="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  <div class="drawer-foot muted small">–í–µ—Ä—Å–∏—è 2025.15</div>
</nav>
<div id="scrim" class="scrim" hidden></div>

<main class="container">
  

  <!-- DASHBOARD -->
  <section id="view-dashboard" class="view">
    <!-- Monthly widget (expanded) -->
    <div id="monthWidget" class="card month-widget" style="display:none">
      <div class="mw-head">
        <div class="mw-title">–ú–µ—Å—è—á–Ω–∞—è –Ω–æ—Ä–º–∞: <b id="mwNorm">‚Äî</b></div>
        <label class="mw-basis">–ë–∞–∑–∞ –Ω–æ—Ä–º—ã:
          <select id="normBasis">
            <option value="calendar">–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –¥–Ω–∏</option>
            <option value="working">–†–∞–±–æ—á–∏–µ –¥–Ω–∏ (–ü–Ω‚Äì–ü—Ç)</option>
          </select>
        </label>
      </div>
      <div class="mw-block">
        <div class="mw-label">–ü—Ä–æ–≥—Ä–µ—Å—Å –º–µ—Å—è—Ü–∞</div>
        <div class="progress"><div id="mwBar"></div></div>
        <div class="progress-nums">
          <div>–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ: <b id="mwWorked">‚Äî</b></div>
          <div>–í—ã–ø–æ–ª–Ω–µ–Ω–æ: <b id="mwPercent">‚Äî</b></div>
        </div>
        <div class="mw-remaining" id="mwRemaining">‚Äî</div>
      </div>
      <div class="mw-block">
        <div class="mw-label">–ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
        <div class="progress alt"><div id="planBar"></div></div>
        <div class="progress-nums">
          <div>–ü–ª–∞–Ω –¥–æ —Å–µ–≥–æ–¥–Ω—è: <b id="planHours">‚Äî</b></div>
          <div>–í—ã–ø–æ–ª–Ω–µ–Ω–æ –æ—Ç –ø–ª–∞–Ω–∞: <b id="planPercent">‚Äî</b></div>
        </div>
      </div>
    </div>

    <div id="quickGo" class="card subtle" hidden>
      <div class="toolbar">
        <div><b>–°–º–µ–Ω–∞ –∑–∞–ø—É—â–µ–Ω–∞</b> ‚Ä¢ —Å—Ç–∞—Ä—Ç: <span id="goStart"></span></div>
        <div>
          <button id="goAddStop" class="btn">–°—Ç–æ—è–Ω–∫–∞</button>
          <button id="goFinish" class="btn primary">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
        </div>
      </div>
      <div class="muted small">–ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –ø–æ–µ–∑–¥–∫–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º —è–≤–∫–∏/–æ–∫–æ–Ω—á–∞–Ω–∏—è –∏ –Ω–∞–±—Ä–æ—Å–∫–æ–º –º–∞—Ä—à—Ä—É—Ç–∞.</div>
    </div>

    <div class="filters card">
      <input id="searchQuery" type="text" placeholder="–ü–æ–∏—Å–∫: —É—á–∞—Å—Ç–æ–∫, —Å—Ç–∞–Ω—Ü–∏—è, ‚Ññ –ø–æ–µ–∑–¥–∞, –ª–æ–∫–æ–º–æ—Ç–∏–≤">
      <select id="filterMonth"><option value="">–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</option></select>
      <select id="filterMode"><option value="">–í—Å–µ —Ä–µ–∂–∏–º—ã</option><option value="electro">–≠–ª–µ–∫—Ç—Ä–æ</option><option value="diesel">–î–∏–∑–µ–ª—å</option></select>
      <button id="clearFiltersBtn" class="btn ghost">–°–±—Ä–æ—Å</button>
    </div>

    <div class="segmented">
      <button class="seg active" data-seg="days">–ü–æ –¥–Ω—è–º</button>
      <button class="seg" data-seg="months">–ü–æ –º–µ—Å—è—Ü–∞–º</button>
      <button class="seg" data-seg="payroll">–†–∞—Å—á—ë—Ç —Å–ø—Ä–∞–≤–∫–∏</button>
    </div>

    <div id="daysView" class="stack"></div>
    <div id="monthsView" class="stack" hidden></div>
    <div id="payrollView" class="stack" hidden></div>

    <button id="fabAddTrip" class="fab" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–µ–∑–¥–∫—É">+</button>
  
    <div class="row" style="margin-top:10px">
      <button id="checkUpdateBtn" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
    </div>
  </section>

  <!-- SECTIONS -->
  <section id="view-sections" class="view" hidden>
    <div class="toolbar">
      <h2>–£—á–∞—Å—Ç–∫–∏</h2>
      <button id="addSectionBtn" class="btn">–ù–æ–≤—ã–π —É—á–∞—Å—Ç–æ–∫</button>
    </div>
    <div id="sectionList" class="stack"></div>
  
    <div class="row" style="margin-top:10px">
      <button id="checkUpdateBtn" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
    </div>
  </section>

  <!-- TARIFFS -->
  <section id="view-tariffs" class="view" hidden>
    <h2>–¢–∞—Ä–∏—Ñ–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –∏ –Ω–∞–¥–±–∞–≤–∫–∏</h2>
    <div class="card form">
      <div class="row"><label>–¢–∞—Ä–∏—Ñ–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (—Ä—É–±/—á–∞—Å)</label><input id="tar_base" type="number" inputmode="decimal" placeholder="358.46"></div>
      <div class="grid2">
        <div class="row"><label>–†–∞–π–æ–Ω–Ω—ã–π</label><input id="tar_region" type="number" inputmode="decimal" placeholder="20"><span class="suffix">%</span></div>
        <div class="row"><label>–°–µ–≤–µ—Ä–Ω—ã–π</label><input id="tar_north" type="number" inputmode="decimal" placeholder="50"><span class="suffix">%</span></div>
        <div class="row"><label>–ö–ª–∞—Å—Å</label><input id="tar_class" type="number" inputmode="decimal" placeholder="0"><span class="suffix">%</span></div>
        <div class="row"><label>–ó–æ–Ω–∞–ª—å–Ω–∞—è</label><input id="tar_zone" type="number" inputmode="decimal" placeholder="0"><span class="suffix">%</span></div>
        <div class="row"><label>–ë–ê–ú</label><input id="tar_bam" type="number" inputmode="decimal" placeholder="0"><span class="suffix">%</span></div>
        <div class="row"><label>–ö–æ–º. —Ä–∞—Å—Ö–æ–¥—ã (–∑–∞ –ø–æ–µ–∑–¥–∫—É)</label><input id="tar_comm" type="number" inputmode="decimal" placeholder="0"><span class="suffix">‚ÇΩ</span></div>
      </div>
      <div class="row"><label>–ú–µ—Å—è—á–Ω–∞—è –Ω–æ—Ä–º–∞ (—á)</label><input id="tar_month_norm" type="number" inputmode="decimal" placeholder="176"></div>
      <div class="row">
        <button id="saveTariffsBtn" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="resetTariffsBtn" class="btn ghost">–°–±—Ä–æ—Å</button>
      </div>
    </div>
  
    <div class="row" style="margin-top:10px">
      <button id="checkUpdateBtn" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
    </div>
  </section>

  <!-- CALCULATORS -->
  <section id="view-calc" class="view" hidden>
    <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã</h2>
    <div class="grid2">
      <div class="card form">
        <h3>–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è</h3>
        <div class="row"><label>–∫–í—Ç¬∑—á</label><input id="kwh" type="number" inputmode="decimal" placeholder="0"></div>
        <div class="row"><label>–¶–µ–Ω–∞ –∑–∞ –∫–í—Ç¬∑—á (‚ÇΩ)</label><input id="kwh_price" type="number" inputmode="decimal" placeholder="0"></div>
        <div class="row"><button id="calcEnergyBtn" class="btn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button></div>
        <div class="muted">–°—Ç–æ–∏–º–æ—Å—Ç—å: <b id="energyCost">‚Äî</b></div>
      </div>
      <div class="card form">
        <h3>–¢–æ–ø–ª–∏–≤–æ</h3>
        <div class="row"><label>–õ–∏—Ç—Ä—ã</label><input id="fuel_l" type="number" inputmode="decimal" placeholder="0"></div>
        <div class="row"><label>–¶–µ–Ω–∞ –∑–∞ –ª–∏—Ç—Ä (‚ÇΩ)</label><input id="fuel_price" type="number" inputmode="decimal" placeholder="0"></div>
        <div class="row"><button id="calcFuelBtn" class="btn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button></div>
        <div class="muted">–°—Ç–æ–∏–º–æ—Å—Ç—å: <b id="fuelCost">‚Äî</b></div>
      </div>
    </div>
  
    <div class="row" style="margin-top:10px">
      <button id="checkUpdateBtn" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
    </div>
  </section>

  <!-- DB TOOLS -->
  <section id="view-db" class="view" hidden>
    <h2>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
    <div class="card form">
      <div class="row"><button id="backupBtn" class="btn">–°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</button></div>
      <div class="row"><input id="restoreFile" type="file" accept="application/json"></div>
      <div class="row"><button id="clearDbBtn" class="btn danger">–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞</button></div>
    </div>
  
    <div class="row" style="margin-top:10px">
      <button id="checkUpdateBtn" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
    </div>
  </section>

  <!-- REFS -->
  <section id="view-refs" class="view" hidden>
    <h2>–°–ø—Ä–∞–≤–∫–∞ / –®–ø–∞—Ä–≥–∞–ª–∫–∏</h2>
    <div class="card form">
      <textarea id="refText" placeholder="–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ —à–ø–∞—Ä–≥–∞–ª–∫–∏‚Ä¶"></textarea>
      <div class="row"><button id="saveRefsBtn" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button id="clearRefsBtn" class="btn ghost">–û—á–∏—Å—Ç–∏—Ç—å</button></div>
    </div>
  
    <div class="row" style="margin-top:10px">
      <button id="checkUpdateBtn" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
    </div>
  </section>

  <!-- SETTINGS -->
  <section id="view-settings" class="view" hidden>
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    <div class="card form">
      <div class="row"><label>–¢–µ–º–∞</label><select id="themeSelect"><option value="dark">–¢—ë–º–Ω–∞—è</option><option value="light">–°–≤–µ—Ç–ª–∞—è</option></select></div>
      <div class="row"><button id="exportBtn" class="btn">–≠–∫—Å–ø–æ—Ä—Ç</button><input id="importFile" type="file" accept="application/json"></div>
    </div>
  
    <div class="row" style="margin-top:10px">
      <button id="checkUpdateBtn" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
    </div>
  </section>
<div id="updateBanner" class="card" style="display:none; margin:10px 0; background:#13202a; border-color:#254052;">
  –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ. <button id="reloadBtn" class="btn primary" style="margin-left:10px">–û–±–Ω–æ–≤–∏—Ç—å</button>
</div>
</main>

<footer class="footer muted small">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ ‚Ä¢ –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞</footer>

<script src="app.js"></script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('./sw.js').then(reg=>{
      // Initial check
      if (reg.waiting) { showUpdateBanner(reg); }
      // When a new SW is found
      reg.addEventListener('updatefound', ()=>{
        const newWorker = reg.installing;
        if (!newWorker) return;
        newWorker.addEventListener('statechange', ()=>{
          if (newWorker.state === 'installed') {
            if (navigator.serviceWorker.controller) {
              showUpdateBanner(reg);
            }
          }
        });
      });
      // Listen for controllerchange to auto-reload once
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', ()=>{
        if (refreshing) return;
        refreshing = true;
        window.location.reload();
      });
    });
  });
}
function showUpdateBanner(reg){
  const b = document.getElementById('updateBanner');
  const btn = document.getElementById('reloadBtn');
  if(!b||!btn) return;
  b.style.display = 'block';
  btn.onclick = ()=>{
    if (reg.waiting) {
      reg.waiting.postMessage({type:'SKIP_WAITING'});
    }
  };
}
</script>
</body>
</html>
